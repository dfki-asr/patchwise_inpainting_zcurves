cmake_minimum_required(VERSION 3.19)

INCLUDE(CommonFlags)

add_definitions(/DTESTDATA_DIR=\"${CMAKE_CURRENT_SOURCE_DIR}\")

# generate source tree
set(ALL_LIST_DIRS "")
set(FILE_TYPES *.c *.cc *.cpp *.h *.hpp *.tcc)
foreach(TEST_SOURCE_DIR ${TEST_SOURCE_DIRS})
    find_directories(DIRS ${TEST_SOURCE_DIR} "${FILE_TYPES}")
    set(ALL_LIST_DIRS "${ALL_LIST_DIRS};${DIRS}")
endforeach()
generate_source_tree(HOST_SOURCES "${ALL_LIST_DIRS}" "${FILE_TYPES}")

include_directories("${INPAINTING_DEPENDENCIES_ROOT}"
					"${FREEIMAGEPLUS_INCLUDE_PATH}"
					"${MKL_INCLUDE_DIR}"
					"${DAAL_INCLUDE_DIR}"
                    "${RAPID_XML_INCLUDE_DIR}"
					"${LIBGTEST_INCLUDE_DIR}"
					"${LIBMEMORYMANAGER_INCLUDE_DIR}"
                    "${LIBTP_INCLUDE_DIR}"
					"${LIBMMV_INCLUDE_DIR}"
					"${LIBCFG_INCLUDE_DIR}"
					"${LIBINPAINTING_INCLUDE_DIR}"
					"${TEST_INCLUDE_DIR}")

add_executable(${PROJECT_NAME} 
			   ${HOST_SOURCES}
)

target_link_libraries(${PROJECT_NAME} 
                      ${MKL_LIBRARIES}
                      ${DAAL_LIBRARIES}
                      libmmv
                      libCFG
                      libThreadPool
                      libInpainting
					  gtest
					  MemoryManager
)

if(CMAKE_COMPILER_IS_GNUCC)
	target_link_options(${PROJECT_NAME} PRIVATE ${MKL_LINKER_OPTIONS})
	target_link_directories(${PROJECT_NAME} PRIVATE ${MKL_ROOT_DIR}/lib/intel64/ ${TBB_LIB_DIR} ${DAAL_LIB_DIR})
endif(CMAKE_COMPILER_IS_GNUCC)

target_precompile_headers(${PROJECT_NAME} PRIVATE "${LIBINPAINTING_INCLUDE_DIR}/stdafx.h")

CopyDlls()
CopyInpaintingDlls()